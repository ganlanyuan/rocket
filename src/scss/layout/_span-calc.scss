// *** span-calc *** // 

// columns-width
@function column-width ( $column, $columns, $gutter ){
  $column-percentage: percentage($column / $columns);
  $column-gutter: ($gutter * $column / $columns);
  @return #{$column-percentage} + #{$column-gutter};
}

@mixin span-calc($span-calc-var){
  $column: 0;
  $columns: 0;
  $gutter: 0;
  $move: false;
  $float: false;
  $last: false;
  $keep: false;

  @if type-of($span-calc-var) == number {
    $column: $span-calc-var;
  } @else if type-of($span-calc-var) == list {
    @each $direction in left, right {
      @if index($span-calc-var, $direction) { 
        $float: $direction;
      } 
    }
    @if index($span-calc-var, keep) {
      $keep: true;
    }
    @if index($span-calc-var, last) {
      $last: true;
    }
    @if index($span-calc-var, of) {
      $column: get-prev($span-calc-var, of);
      $columns: get-next($span-calc-var, of);
    } @else {
      $col: 1;
      @while nth($span-calc-var, $col) and is-number(nth($span-calc-var, $col)) == false {
        $col: $col + 1;
      }
      $column: nth($span-calc-var, $col);
    }
    @if index($span-calc-var, gutter) {
      $gutter: get-next($span-calc-var, gutter);
    }
    @if index($span-calc-var, move) {
      $move: get-next($span-calc-var, move);
    }
  }

  // direction
  @if not $keep {
    @if $float == right { float: $float; }
    @else { float: left; }
  }

  // change order
  @if $move { position: relative; }

  // add unit to gutter
	@if $gutter and unitless($gutter) and $gutter > 0 and $gutter < 1 { $gutter: percentage($gutter); }

  // no gutter
  @if not $gutter or $gutter == 0 {
    width: column-width-percentage($columns, 0) * $column;
    @if $move and $move != 0 { left: percentage($move / $columns); }
  }
  // fixed gutter
  @else if unit($gutter) and unit($gutter) != '%' {
    $column-width: column-width($column, $columns, $gutter);
    width: calc( #{$column-width} - #{$gutter} );
    @if not $keep {
      @if not $last { 
        @if $float == left or $float == right {
          margin-#{opposite($float)}: $gutter; 
        }
        @else { margin-right: $gutter; }
      }
    }
    // change order
    @if $move and $move != 0 { 
      $column-width: column-width($move, $columns, $gutter);
      left: calc( #{$column-width} ); 
    }
  }
  @else {
    $warn: "$gutter can't be a percentage, use a fixed $gutter instead.";
    @warn $warn + ' Current value: #{$gutter}';
  }
}
