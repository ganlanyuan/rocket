// *** span-calc *** // 

@mixin span-calc($span-calc-var){
  $column: 0;
  $columns: 0;
  $gutter: 0;
  $move: false;
  $float: false;
  $last: false;
  $keep: false;

  @if type-of($span-calc-var) == number {
    $column: $span-calc-var;
  } @else if type-of($span-calc-var) == list {

    // set up direction
    @each $direction in left, right {
      @if index($span-calc-var, $direction) { 
        $float: $direction;
      } 
    }

    // set up keep
    @if index($span-calc-var, keep) {
      $keep: true;
    }

    // set up last
    @if index($span-calc-var, last) {
      $last: true;
    }

    // set up move
    @if index($span-calc-var, move) {
      $move: get-next($span-calc-var, move);
    }

    // set up gutter
    @for $i from 1 through length($span-calc-var) {
      $val: nth($span-calc-var, $i);

      @if type-of($val) == number and
          not unitless($val) {
        $gutter: $val;
      }
    }

    // set up column, columns
    @if index($span-calc-var, of) {
      $column: get-prev($span-calc-var, of);
      $columns: get-next($span-calc-var, of);
    } @else {
      @for $i from 1 through length($span-var) {
        $val: nth($span-var, $i);

        @if type-of($val) == number and
            unitless($val) {
          $column: $val;
        }
      }
    }
  }

  // direction
  @if not $keep {
    @if $float == right { float: $float; }
    @else { float: left; }
  }

  // change order
  @if $move { position: relative; }

  // add unit to gutter
	@if $gutter and unitless($gutter) and $gutter > 0 and $gutter < 1 { $gutter: percentage($gutter); }

  // no gutter
  @if not $gutter or $gutter == 0 {
    width: percentage($column / $columns);

    // move
    @if $move and $move != 0 { left: percentage($move / $columns); }
  
  // fixed gutter
  } @else if unit($gutter) and unit($gutter) != '%' {
    $column-width: calc-column-width($column, $columns, $gutter);
    width: calc( #{$column-width} - #{$gutter} );
    @if not $keep {
      @if not $last { 
        @if $float == left or $float == right {
          margin-#{opposite($float)}: $gutter; 
        }
        @else { margin-right: $gutter; }
      }
    }
    // move
    @if $move and $move != 0 { 
      $column-width: calc-column-width($move, $columns, $gutter);
      left: calc( #{$column-width} ); 
    }
  } @else {
    $warn: "$gutter can't be a percentage, use a fixed $gutter instead.";
    @warn $warn + ' Current value: #{$gutter}';
  }
}
