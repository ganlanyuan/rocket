/// *gallery* is for creating picture galleries.
/// 
/// $key: `$per-row $gutter (child $child) $float $position keep`
/// @group layout
/// @param {number | list} $key - key 
/// @example scss - Usage
/// .pic { @include gallery(3 2% child li middle); }
/// // per-row: 3;
/// // gutter: 2%;
/// // child: li;
/// // float: left; (default)
/// // position: middle; (same padding on the top and bottom for each item)
/// 
/// .pic { @include gallery(4 child li keep); }
/// // Keep: similar with span(keep).
/// 
/// @link http://creatiointl.org/gallery/william/rocket/layout-gallery.php demo
/// @link https://github.com/ganlanyuan/rocket full document

@mixin gallery($key){
  $per-row: 1;
  $gutter: map-get($ro-layout, gutter);
  $child: ro-get-next($key, 'child', 'li');
  $float: ro-get($key, left right, left);
  $position: ro-get($key, 'middle' 'bottom', 'bottom');
  $keep: ro-get($key, 'keep');

  // set up per-row, gutter
  @if type-of($key) == 'number' {
    $per-row: $key;  
  } @else if type-of($key) == list {
    @each $item in $key {
      @if type-of($item) == number {
        @if unitless($item) {
          $per-row: $item;
        } @else {
          $gutter: $item;
        }
      }
    }
  }
  $half-gutter: ($gutter / 2);

  // *** output *** //
  @include flexbox;
  @include flex-wrap(wrap);
  @include align-content(stretch);

  // fix left and right edge padding
  @if not $keep {
    margin-left: - $half-gutter;
    margin-right: - $half-gutter;
  }

  > #{$child} {
    @if not $keep {
      @include flex(1 1);
      box-sizing: border-box;
      @if unit($gutter) != '%' {
        padding: 0 $half-gutter $gutter; 
      } @else {
        padding-left: $half-gutter;
        padding-right: $half-gutter;
      }
    }
    @if unit($gutter) == '%' {
      // fix firefox treat percentage gutter as 0
      &:after {
        content: '';
        display: block;
        padding-bottom: ($gutter * $per-row);
      }
    }

    // set col width
    @include flex-basis(percentage(1 / $per-row));
    // fix IE10 & 11: horizental padding break layout
    .flexboxtweener & {
      max-width: percentage(1 / $per-row);
    }
  }

  // for non-flex, non-flexwrap browsers
  .no-flexwrap & { display: block; }
  .no-flexbox.no-flexboxtweener &,
  .no-flexwrap & {
    @if not $keep { @include clearfix(); }
  
    > #{$child} {
      @if not $keep { float: $float; }

      width: percentage(1 / $per-row);
      &:nth-child(#{$per-row}n+1) { clear: both; }
      @for $i from 2 through $per-row {
        &:nth-child(#{$per-row}n+#{$i}) { clear: none; }
      }
    }
  }
}
