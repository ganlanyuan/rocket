@import 'wrap';

@mixin gallery($gallery-var){
  $per-row: 1;
  $gutter: map-get($layout, gutter);
  $child: li;
  $position: middle;
  $keep: false;

  @if type-of($gallery-var) == number {
    $per-row: $gallery-var;  
  } @else if type-of($gallery-var) == list {

    // set up per-row, gutter
    @for $i from 1 through length($gallery-var) {
      $val: nth($gallery-var, $i);

      @if type-of($val) == number {
        @if unitless($val) {
          $per-row: $val;
        } @else {
          $gutter: $val;
        }
      }
    }

    // set up position
    @each $this-position in middle, bottom {
      @if index($gallery-var, $this-position) { 
        $position: $this-position;
      } 
    }

    // set up child
    @if index($gallery-var, child) {
      $child: get-next($gallery-var, child);
    }

    // set up keep
    @if index($gallery-var, keep) {
      $keep: true;
    }
  }

  // set up gallery container
  @if not $keep {
    @if $gutter and $gutter != 0 and $gutter != null {
      @include wrap($gutter);
    }
  }
  @at-root (without: media) { @extend %layout-wrap; }

  // set up gallery items
  > #{$child} {
    width: percentage(1 / $per-row);
    @at-root (without: media) { @extend %layout-span; }

    // set up gallery gutter
    @if not $keep {
      @if $gutter and $gutter != 0 and $gutter != null {
        @if $position == bottom { padding: 0 ($gutter / 2) $gutter; }
        @else { padding: ($gutter / 2); }
      }
    }
  }
}
